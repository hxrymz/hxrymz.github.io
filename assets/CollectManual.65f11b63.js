import{S as $,C as J,T as Q,o as V,L as W,r as N,u as y,b as f,g as t,j as a,a as c,h as A,M as X,i as Z}from"./index.d92c6cda.js";/* empty css               */import{CloseModal as ee}from"./DialogHRM.05c7f368.js";import{S as ce}from"./server_fetching.d6b0e853.js";/* empty css                  */const te=$();J();const S=Q(),le=V(),j=W(),s="new_cobro_comprobante",me=({data:e,confirm:u})=>{var r,D,T,w,F,M,O,P;const[x,p]=N.exports.useState(!1),[I,_]=N.exports.useState(0);N.exports.useEffect(()=>{x||(p(!0),y("accountPicker",{}),_(f()))});const h=(l,i,d)=>{let o=t(s)||{};d?(o[d]||(o[d]={}),o[d][l]=i):o[l]=i,y(s,o),_(f())},n=async()=>{var E,k;let l=t(s),i=[];l.date?l.date=new Date(l.date).getTime():l.date=Date.now();let d=new Date;l.comprobanteId=d.getFullYear()+""+(d.getMonth()+1)+"-"+X();let o={...l},G=se(t("multi_collect_by_doc"));o.document=o.collectDocument,o.account=t("PaymentMethodAccount").account;let q=(E=t("account_ids"))==null?void 0:E[o.account];q.payOrCollect&&(o.payOrCollect=q.payOrCollect),o.subAccount=t("PaymentMethodAccount").subAccount,o.type="debit",o.amount=G*1,o.operationId=f();let K={query:"addOperationsHRG",params:{businessId:(k=t("profileUser"))==null?void 0:k.businessId},form:o};i.push(K);let v=t("multi_collect_by_doc")&&A(t("multi_collect_by_doc"));v&&(v==null||v.map((g,L)=>{var B,H,R;let m={...l},U=t("multi_collect_by_doc")[g];m.document=g,m.account=(B=t("Acc2Collect"))==null?void 0:B.account,m.subAccount=(H=t("Acc2Collect"))==null?void 0:H.subAccount,m.type="credit",m.amount=U*1,m.payOrCollect="collect",m.operationId=f();let Y={query:"addOperationsHRG",params:{businessId:(R=t("profileUser"))==null?void 0:R.businessId},form:m};i.push(Y)}));const z=i.map(async g=>{await Z(g)});await Promise.all(z),e!=null&&e.modalID&&ee({id:e==null?void 0:e.modalID}),setTimeout(()=>{y("multi_collect_by_doc",null),y(s,null),_(f()),u&&u()},400)},C=(l,i)=>{y("PaymentMethodAccount",{account:l,subAccount:i})};let b=ce(t("collect_by_doc"),"amount");return a("div",{style:{maxHeight:"90vh",minHeight:"88vh",width:"560px",overflow:"auto",background:"#fff",borderRadius:13,padding:"10px 19px"},children:[a("div",{className:"_dsplFlx ",children:[c("p",{className:"form_title",children:"Registrando Cobro"}),c("div",{className:"flexSpace"})]}),c("div",{className:"_dsplFlx ",children:a("div",{className:"_dsplFlx ",style:{padding:"35px 18px 10px "},children:[c("div",{className:"flexSpace"}),c(le,{data:[{label:"Cheque",id:"check"},{label:"Tarjeta",id:"card"}],active:((r=t(s))==null?void 0:r.paymentType)||"check",updSelect:l=>h("paymentType",l)}),c("div",{className:"flexSpace"})]})}),((D=t(s))==null?void 0:D.paymentType)==="card"?c(j,{query:"Cred",type:(T=t(s))==null?void 0:T.paymentType,handleClick:C}):c(j,{query:"Efectivo",type:(w=t(s))==null?void 0:w.paymentType,handleClick:C}),a("div",{className:"_dsplFlx ",children:[c(S,{init:(F=t(s))==null?void 0:F.date,label:"Fecha",width:120,updChanges:l=>h("date",l)}),c("div",{className:"flexSpace"}),c(S,{init:(M=t(s))==null?void 0:M.collectDocument,label:"Documento de Cobro",width:200,updChanges:l=>h("collectDocument",l)})]}),c(S,{init:(O=t(s))==null?void 0:O.description,label:"Descripcion",width:520,updChanges:l=>h("description",l)}),b?a("div",{className:"boxAddAcc",style:{margin:"18px 0"},children:[a("div",{className:"_dsplFlx hdr_bar purple",style:{margin:"18px 0"},children:[c("div",{className:"tr_bar",children:"Documento"}),c("div",{className:"tr_bar",children:"Balance"}),c("div",{className:"tr_bar"}),c("div",{className:"tr_bar",children:"Por Cobrar"})]}),t("collect_by_doc")&&((P=A(t("collect_by_doc")))==null?void 0:P.map((l,i)=>c(oe,{idKey:l,data:t("collect_by_doc")[l],updObs:_},l)))]}):null,a("div",{className:"_dsplFlx ",children:[c("div",{className:"flexSpace"}),c("div",{className:"card",children:c("button",{onClick:n,children:"Guardar"})})]})]})},oe=({data:e,updObs:u,idKey:x})=>{const[p,I]=N.exports.useState(0),_=n=>{I(n),h(e==null?void 0:e.document,n),u(f())},h=(n,C,b)=>{let r=t("multi_collect_by_doc")||{};b?(r[b]||(r[b]={}),r[b][n]=C):r[n]=C,y("multi_collect_by_doc",r)};return(e==null?void 0:e.amount)*1==0?null:a("div",{className:"_dsplFlx hdr_bar",children:[c("div",{className:"tr_bar",style:{marginTop:10},children:e==null?void 0:e.document}),a("div",{className:"tr_bar",style:{marginTop:10},children:["$",((e==null?void 0:e.amount)*1).toFixed(2)]}),c("div",{className:"tr_bar",style:{marginTop:10},children:p>(e==null?void 0:e.amount)?c("div",{className:"icon",children:c(te,{name:"alert",color:"#c62828"})}):null}),c("div",{className:"tr_bar",children:c(S,{init:p,width:80,updChanges:n=>_(n)})})]})},se=e=>{var x;let u=0;return e&&((x=A(e))==null||x.map((p,I)=>{u+=e[p]*1})),u};export{me as default};
