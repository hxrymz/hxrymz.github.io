import{k as W,d as Y,T as $,w as J,a4 as Q,r as g,u as y,g as x,j as i,a as e,b as c,O as A,W as V,p as X}from"./index.5e7d3da0.js";/* empty css                */import{CloseModal as Z}from"./DialogHRM.6670a4f3.js";/* empty css                  */const ee=W();Y();const S=$(),ce=J(),R=Q(),s="new_cobro_comprobante",ie=({data:t,confirm:p})=>{var u,r,w,T,D,F,O,E;const[f,h]=g.exports.useState(!1),[I,_]=g.exports.useState(0);g.exports.useEffect(()=>{f||(h(!0),y("accountPicker",{}),_(x()))});const b=(l,a,d)=>{let o=c(s)||{};d?(o[d]||(o[d]={}),o[d][l]=a):o[l]=a,y(s,o),_(x())},n=async()=>{var M,P;let l=c(s),a=[];l.date||(l.date=Date.now());let d=new Date;l.comprobanteId=d.getFullYear()+""+(d.getMonth()+1)+"-"+V();let o={...l},j=le(c("multi_collect_by_doc"));o.document=o.collectDocument,o.account=c("PaymentMethodAccount").account;let q=(M=c("account_ids"))==null?void 0:M[o.account];q.payOrCollect&&(o.payOrCollect=q.payOrCollect),o.subAccount=c("PaymentMethodAccount").subAccount,o.type="debit",o.amount=j*1,o.operationId=x();let G={query:"addOperationsHRG",params:{businessId:(P=c("profileUser"))==null?void 0:P.businessId},form:o};a.push(G);let C=c("multi_collect_by_doc")&&A(c("multi_collect_by_doc"));C&&(C==null||C.map((N,z)=>{var k,B,H;let m={...l},U=c("multi_collect_by_doc")[N];m.document=N,m.account=(k=c("Acc2Collect"))==null?void 0:k.account,m.subAccount=(B=c("Acc2Collect"))==null?void 0:B.subAccount,m.type="credit",m.amount=U*1,m.payOrCollect="collect",m.operationId=x();let L={query:"addOperationsHRG",params:{businessId:(H=c("profileUser"))==null?void 0:H.businessId},form:m};a.push(L)}));const K=a.map(async N=>{await X(N)});await Promise.all(K),t!=null&&t.modalID&&Z({id:t==null?void 0:t.modalID}),setTimeout(()=>{y("multi_collect_by_doc",null),y(s,null),_(x()),p&&p()},400)},v=(l,a)=>{y("PaymentMethodAccount",{account:l,subAccount:a})};return i("div",{style:{maxHeight:"90vh",minHeight:"88vh",width:"560px",overflow:"auto",background:"#fff",borderRadius:13,padding:"10px 19px"},children:[i("div",{className:"_dsplFlx ",children:[e("p",{className:"form_title",children:"Registrando Cobro"}),e("div",{className:"flexSpace"})]}),e("div",{className:"_dsplFlx ",children:i("div",{className:"_dsplFlx ",style:{padding:"35px 18px 10px "},children:[e("div",{className:"flexSpace"}),e(ce,{data:[{label:"Efectivo",id:"cash"},{label:"Tarjeta",id:"card"},{label:"Cheque",id:"check"}],active:((u=c(s))==null?void 0:u.paymentType)||"cash",updSelect:l=>b("paymentType",l)}),e("div",{className:"flexSpace"})]})}),((r=c(s))==null?void 0:r.paymentType)==="card"?e(R,{query:"Cred",type:(w=c(s))==null?void 0:w.paymentType,handleClick:v}):e(R,{query:"Efectivo",type:(T=c(s))==null?void 0:T.paymentType,handleClick:v}),i("div",{className:"_dsplFlx ",children:[e(S,{init:(D=c(s))==null?void 0:D.date,label:"Fecha",width:120,updChanges:l=>b("date",l)}),e("div",{className:"flexSpace"}),e(S,{init:(F=c(s))==null?void 0:F.collectDocument,label:"Documento de Cobro",width:200,updChanges:l=>b("collectDocument",l)})]}),e(S,{init:(O=c(s))==null?void 0:O.description,label:"Descripcion",width:520,updChanges:l=>b("description",l)}),i("div",{className:"boxAddAcc",style:{margin:"18px 0"},children:[i("div",{className:"_dsplFlx hdr_bar purple",style:{margin:"18px 0"},children:[e("div",{className:"tr_bar",children:"Documento"}),e("div",{className:"tr_bar",children:"Balance"}),e("div",{className:"tr_bar"}),e("div",{className:"tr_bar",children:"Por Cobrar"})]}),c("collect_by_doc")&&((E=A(c("collect_by_doc")))==null?void 0:E.map((l,a)=>e(te,{idKey:l,data:c("collect_by_doc")[l],updObs:_},l)))]}),i("div",{className:"_dsplFlx ",children:[e("div",{className:"flexSpace"}),e("div",{className:"card",children:e("button",{onClick:n,children:"Guardar"})})]})]})},te=({data:t,updObs:p,idKey:f})=>{const[h,I]=g.exports.useState(0),_=n=>{I(n),b(t==null?void 0:t.document,n),p(x())},b=(n,v,u)=>{let r=c("multi_collect_by_doc")||{};u?(r[u]||(r[u]={}),r[u][n]=v):r[n]=v,y("multi_collect_by_doc",r)};return i("div",{className:"_dsplFlx hdr_bar",children:[e("div",{className:"tr_bar",style:{marginTop:10},children:t==null?void 0:t.document}),i("div",{className:"tr_bar",style:{marginTop:10},children:["$",((t==null?void 0:t.amount)*1).toFixed(2)]}),e("div",{className:"tr_bar",style:{marginTop:10},children:h>(t==null?void 0:t.amount)?e("div",{className:"icon",children:e(ee,{name:"alert",color:"#c62828"})}):null}),e("div",{className:"tr_bar",children:e(S,{init:h,width:80,updChanges:n=>_(n)})})]})},le=t=>{var f;let p=0;return t&&((f=A(t))==null||f.map((h,I)=>{p+=t[h]*1})),p};export{ie as default};
