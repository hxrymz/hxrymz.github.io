import{S as te,C as le,T as re,B as ae,a2 as oe,J as ce,P as ie,r as P,u as F,b as N,g as e,j as m,a as s,h as T,L as ne,i as de}from"./index.921eeb0e.js";/* empty css                */import{CloseModal as ue}from"./DialogHRM.281c65d9.js";/* empty css                  */te();le();const S=re(),k=ae(),pe=oe(),me=ce(),_e=ie(),a="entry_operation_comprobante",Ne=({data:l,confirm:n,item:t})=>{var A,y,D,f,h,q,B,H,K,R,z,G,L,M,U;const[p,x]=P.exports.useState(!1),[o,d]=P.exports.useState(0);P.exports.useEffect(()=>{if(!p){x(!0),F("accountPicker",{}),c("description",t.name),c("customerId",null),c("providerId",null);let r=t.accountsToParameterize;F("multi_params",r),d(N())}});const c=(r,C,_)=>{let I=e(a)||{};_?(I[_]||(I[_]={}),I[_][r]=C):I[r]=C,F(a,I),d(N())},E=async()=>{var W,J,V,Y,j,Q,X;let r={...e(a)};r.date?r.date=new Date(r.date).getTime():r.date=Date.now();let C=new Date;r.comprobanteId=C.getFullYear()+""+(C.getMonth()+1)+"-"+ne();let _=[];if(e("multi_params")&&((W=T(e("multi_params")))==null||W.map(async(i,b)=>{var g,Z;let u=e("multi_params")[i];if(!isNaN(u.amount*1)&&u.amount*1>0){let v={...r};v.account=u.account,v.subAccount=u.subAccount,v.type=u.type,v.amount=u.amount*1,v.operationId=N(),delete v.providerId;let $=(g=e("account_ids"))==null?void 0:g[u.account];$.payOrCollect&&(v.payOrCollect=$.payOrCollect);let se={query:"addOperationsHRG",params:{businessId:(Z=e("profileUser"))==null?void 0:Z.businessId},form:v};_.push(se)}})),(t==null?void 0:t.extra)==="provider"&&((J=e(a))==null?void 0:J.providerId)){let i={...r};i.type="credit";let b=e("providers_ids")[e(a).providerId];i.account=b.account,i.subAccount=b.subAccount,i.amount=w(e("multi_params")),i.operationId=N();let u=(V=e("account_ids"))==null?void 0:V[b.account];u.payOrCollect&&(i.payOrCollect=u.payOrCollect);let g={query:"addOperationsHRG",params:{businessId:(Y=e("profileUser"))==null?void 0:Y.businessId},form:i};_.push(g)}if((t==null?void 0:t.extra)==="customer"&&((j=e(a))==null?void 0:j.customerId)){let i={...r};i.type="debit";let b=e("providers_ids")[e(a).customerId];i.account=b.account,i.subAccount=b.subAccount,i.amount=w(e("multi_params"))*-1,i.operationId=N();let u=(Q=e("account_ids"))==null?void 0:Q[b.account];u.payOrCollect&&(i.payOrCollect=u.payOrCollect);let g={query:"addOperationsHRG",params:{businessId:(X=e("profileUser"))==null?void 0:X.businessId},form:i};_.push(g)}const I=_.map(async i=>{await de(i)});await Promise.all(I),l!=null&&l.modalID&&ue({id:l==null?void 0:l.modalID}),setTimeout(()=>{F("multi_params",null),F(a,null),d(N()),n&&n()},400)};let O=((t==null?void 0:t.extra)==="provider"&&((A=e(a))==null?void 0:A.providerId)||(t==null?void 0:t.extra)==="customer"&&((y=e(a))==null?void 0:y.customerId))&&w(e("multi_params"))!==0;return m("div",{style:{maxHeight:"90vh",minHeight:"88vh",width:"560px",overflow:"auto",background:"#fff",borderRadius:13,padding:"10px 19px"},children:[m("div",{className:"_dsplFlx ",children:[s("p",{className:"form_title",children:"Asiento Manual"}),s("div",{className:"flexSpace"})]}),m("div",{className:"_dsplFlx ",children:[s(S,{init:(D=e(a))==null?void 0:D.date,label:"Fecha",width:120,updChanges:r=>c("date",r)}),s("div",{className:"flexSpace"}),s(S,{init:(f=e(a))==null?void 0:f.document,label:"Documento",width:120,updChanges:r=>c("document",r)})]}),s(S,{init:(h=e(a))==null?void 0:h.description,label:"Descripcion",width:520,updChanges:r=>c("description",r)}),(t==null?void 0:t.extra)==="employee"?s("div",{className:"extra_container",children:(q=e(a))!=null&&q.employeeId?m("div",{className:"_dsplFlx",children:[s("div",{className:"employee_title",style:{color:"#646cff",cursor:"pointer"},onClick:()=>c("employeeId",null),children:"Empleado:"}),s("div",{className:"employee_name",children:(B=e("employees_ids")[e(a).employeeId])==null?void 0:B.name})]}):s(pe,{width:420,handleClick:r=>c("employeeId",r)})}):null,(t==null?void 0:t.extra)==="provider"?s("div",{className:"extra_container",children:(H=e(a))!=null&&H.providerId?m("div",{className:"_dsplFlx",children:[s("div",{className:"employee_title",style:{color:"#646cff",cursor:"pointer"},onClick:()=>c("providerId",null),children:"Provedor:"}),s("div",{className:"employee_name",children:(K=e("providers_ids")[e(a).providerId])==null?void 0:K.name})]}):s(me,{width:420,handleClick:r=>c("providerId",r==null?void 0:r.providerId)})}):null,(t==null?void 0:t.extra)==="customer"?s("div",{className:"extra_container",children:(R=e(a))!=null&&R.customerId?m("div",{className:"_dsplFlx",children:[s("div",{className:"employee_title",style:{color:"#646cff",cursor:"pointer"},onClick:()=>c("customerId",null),children:"Cliente:"}),s("div",{className:"employee_name",children:(z=e("providers_ids")[e(a).customerId])==null?void 0:z.name})]}):s(_e,{width:420,handleClick:r=>c("customerId",r==null?void 0:r.providerId)})}):null,m("div",{className:"boxAddAcc",style:{margin:"18px 0"},children:[m("div",{className:"_dsplFlx hdr_bar purple",style:{margin:"18px 0"},children:[s("div",{className:"tr_bar",children:"Cuenta"}),s("div",{className:"tr_bar",children:"Sub Cuenta"}),s("div",{className:"tr_bar"}),s("div",{className:"tr_bar",children:"Importe"})]}),(G=e(a))!=null&&G.customerId?s(ee,{idKey:e(a).customerId,data:e("providers_ids")[e(a).customerId],total:w(e("multi_params")),type:"debit"}):null,e("multi_params")&&((L=T(e("multi_params")))==null?void 0:L.map((r,C)=>s(be,{idKey:r,data:e("multi_params")[r],updObs:d},r))),(M=e(a))!=null&&M.providerId?s(ee,{idKey:e(a).providerId,data:e("providers_ids")[e(a).providerId],total:w(e("multi_params")),type:"credit"}):null]}),m("div",{className:"_dsplFlx ",children:[s("div",{className:"flexSpace"}),((U=e(a))==null?void 0:U.document)&&(O||he(e("multi_params")))?s("div",{className:"card",children:s("button",{className:"group_title addBtn purple",onClick:E,children:"Guardar"})}):null]})]})},be=({data:l,updObs:n,idKey:t})=>{var O,A;const[p,x]=P.exports.useState(0),o=y=>{d("amount",y,t),n(N())},d=(y,D,f)=>{let h=e("multi_params")||{};f?(h[f]||(h[f]={}),h[f][y]=D):h[y]=D,F("multi_params",h)};let c=(O=e("account_ids"))==null?void 0:O[l==null?void 0:l.account],E=(A=e("sub_account_ids"))==null?void 0:A[l==null?void 0:l.subAccount];return m("div",{className:"_dsplFlx hdr_bar",children:[s("div",{className:"tr_bar",style:{marginTop:10,fontWeight:600,color:l.type==="debit"?"#009688":"#c62828"},children:s(k,{data:c,color:l.type==="debit"?"#009688":"#c62828",labelField:"code",infoField:"name"})}),s("div",{className:"tr_bar",style:{marginTop:10},children:s(k,{data:E,color:l.type==="debit"?"#009688":"#c62828",labelField:"subAccount",infoField:"subAccountName"})}),s("div",{className:"tr_bar",style:{marginTop:10}}),s("div",{className:"tr_bar",children:s(S,{init:p,type:"number",width:80,init:l==null?void 0:l.amount,updChanges:o})})]})},ee=({data:l,idKey:n,total:t,type:p})=>{var d,c;P.exports.useState(0);let x=(d=e("account_ids"))==null?void 0:d[l==null?void 0:l.account],o=(c=e("sub_account_ids"))==null?void 0:c[l==null?void 0:l.subAccount];return m("div",{className:"_dsplFlx hdr_bar",children:[s("div",{className:"tr_bar",style:{marginTop:10,fontWeight:600,color:p==="debit"?"#009688":"#c62828"},children:s(k,{data:x,color:p==="debit"?"#009688":"#c62828",labelField:"code",infoField:"name"})}),s("div",{className:"tr_bar",style:{marginTop:10},children:s(k,{data:o,color:p==="debit"?"#009688":"#c62828",labelField:"subAccount",infoField:"subAccountName"})}),s("div",{className:"tr_bar",style:{marginTop:10}}),s("div",{className:"tr_bar",style:{marginTop:10},children:s("div",{className:"total_cntra",children:t*(p==="debit"?-1:1).toFixed(2)})})]})},w=l=>{let n=0,t=l&&T(l);return t&&(t==null||t.map((p,x)=>{let o=l[p],d=n.toFixed(2);n=(o!=null&&o.amount?(o==null?void 0:o.type)==="debit"?parseFloat(o.amount):parseFloat(o.amount)*-1:0)+parseFloat(d)})),n},he=l=>{let n=0,t=l&&T(l);return t&&(t==null||t.map((p,x)=>{let o=l[p],d=n.toFixed(2);n=(o!=null&&o.amount?(o==null?void 0:o.type)==="debit"?parseFloat(o.amount):parseFloat(o.amount)*-1:0)+parseFloat(d)})),t&&(t==null?void 0:t.length)>0&&n===0};export{Ne as default};
