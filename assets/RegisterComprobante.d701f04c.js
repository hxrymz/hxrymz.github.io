import{k as M,d as R,T as j,Q as q,r as F,u as g,g as C,b as a,j as b,a as s,O as D,W as B,p as G}from"./index.4d86f257.js";/* empty css                */import{CloseModal as K}from"./DialogHRM.d0e5db0b.js";/* empty css                  */M();R();const I=j(),P=q(),o="entry_operation_comprobante",X=({data:t,confirm:c,item:l})=>{var x,N,r,v,m;const[y,A]=F.exports.useState(!1),[i,_]=F.exports.useState(0);F.exports.useEffect(()=>{if(!y){A(!0),g("accountPicker",{}),h("description",l.name);let e=l.accountsToParameterize;g("multi_params",e),_(C())}});const h=(e,f,u)=>{let p=a(o)||{};u?(p[u]||(p[u]={}),p[u][e]=f):p[e]=f,g(o,p),_(C())},S=async()=>{var T;let e={...a(o)};e.date||(e.date=Date.now());let f=new Date;e.comprobanteId=f.getFullYear()+""+(f.getMonth()+1)+"-"+B();let u=[];a("multi_params")&&((T=D(a("multi_params")))==null||T.map(async(w,H)=>{var O,E;let d=a("multi_params")[w];if(!isNaN(d.amount*1)&&d.amount*1>0){let n={...e};n.type="debit",n.account=d.account,n.subAccount=d.subAccount,n.type=d.type,n.amount=d.amount*1,n.operationId=C();let z=(O=a("account_ids"))==null?void 0:O[d.account];z.payOrCollect&&(n.payOrCollect=z.payOrCollect);let L={query:"addOperationsHRG",params:{businessId:(E=a("profileUser"))==null?void 0:E.businessId},form:n};u.push(L)}}));const p=u.map(async w=>{await G(w)});await Promise.all(p),t!=null&&t.modalID&&K({id:t==null?void 0:t.modalID}),setTimeout(()=>{g("multi_params",null),g(o,null),_(C()),c&&c()},400)};return b("div",{style:{maxHeight:"90vh",minHeight:"88vh",width:"560px",overflow:"auto",background:"#fff",borderRadius:13,padding:"10px 19px"},children:[b("div",{className:"_dsplFlx ",children:[s("p",{className:"form_title",children:"Asiento Manual"}),s("div",{className:"flexSpace"})]}),b("div",{className:"_dsplFlx ",children:[s(I,{init:(x=a(o))==null?void 0:x.date,label:"Fecha",width:120,updChanges:e=>h("date",e)}),s("div",{className:"flexSpace"}),s(I,{init:(N=a(o))==null?void 0:N.document,label:"Documento",width:120,updChanges:e=>h("document",e)})]}),s(I,{init:(r=a(o))==null?void 0:r.description,label:"Descripcion",width:520,updChanges:e=>h("description",e)}),b("div",{className:"boxAddAcc",style:{margin:"18px 0"},children:[b("div",{className:"_dsplFlx hdr_bar purple",style:{margin:"18px 0"},children:[s("div",{className:"tr_bar",children:"Cuenta"}),s("div",{className:"tr_bar",children:"Sub Cuenta"}),s("div",{className:"tr_bar"}),s("div",{className:"tr_bar",children:"Importe"})]}),a("multi_params")&&((v=D(a("multi_params")))==null?void 0:v.map((e,f)=>s(W,{idKey:e,data:a("multi_params")[e],updObs:_},e)))]}),b("div",{className:"_dsplFlx ",children:[s("div",{className:"flexSpace"}),((m=a(o))==null?void 0:m.document)&&Q(a("multi_params"))?s("div",{className:"card",children:s("button",{className:"group_title addBtn purple",onClick:S,children:"Guardar"})}):null]})]})},W=({data:t,updObs:c,idKey:l})=>{var x,N;const[y,A]=F.exports.useState(0),i=r=>{_("amount",r,l),c(C())},_=(r,v,m)=>{let e=a("multi_params")||{};m?(e[m]||(e[m]={}),e[m][r]=v):e[r]=v,g("multi_params",e)};let h=(x=a("account_ids"))==null?void 0:x[t==null?void 0:t.account],S=(N=a("sub_account_ids"))==null?void 0:N[t==null?void 0:t.subAccount];return b("div",{className:"_dsplFlx hdr_bar",children:[s("div",{className:"tr_bar",style:{marginTop:10,fontWeight:600,color:t.type==="debit"?"#009688":"#c62828"},children:s(P,{data:h,color:t.type==="debit"?"#009688":"#c62828",labelField:"code",infoField:"name"})}),s("div",{className:"tr_bar",style:{marginTop:10},children:s(P,{data:S,color:t.type==="debit"?"#009688":"#c62828",labelField:"subAccount",infoField:"subAccountName"})}),s("div",{className:"tr_bar",style:{marginTop:10}}),s("div",{className:"tr_bar",children:s(I,{init:y,width:80,init:t==null?void 0:t.amount,updChanges:i})})]})},Q=t=>{let c=0,l=t&&D(t);return l&&(l==null||l.map((y,A)=>{let i=t[y];(i==null?void 0:i.type)==="debit"?c+=(i==null?void 0:i.amount)*1||0:(i==null?void 0:i.type)==="credit"&&(c-=(i==null?void 0:i.amount)*1||0)})),l&&(l==null?void 0:l.length)>0&&c===0};export{X as default};
